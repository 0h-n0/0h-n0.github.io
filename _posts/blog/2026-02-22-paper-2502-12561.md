---
layout: post
title: "論文解説: Towards a Theoretical Understanding of Why and When Multi-Agent Workflows Work Better than Single-Agent Workflows"
description: "マルチエージェントワークフローが単一エージェントに勝る条件を情報理論で定式化した論文の詳細解説"
categories: [blog, paper, arxiv]
tags: [multi-agent, LLM, workflow, information-theory, langgraph, RAG]
date: 2026-02-22 23:00:00 +0900
source_type: arxiv
arxiv_id: 2502.12561
source_url: https://arxiv.org/abs/2502.12561
zenn_article: c5c769fcd39455
zenn_url: https://zenn.dev/0h_n0/articles/c5c769fcd39455
math: true
mermaid: true
target_audience: "修士学生レベル"
---

本記事は [arXiv:2502.12561](https://arxiv.org/abs/2502.12561) の解説記事です。

## 論文概要（Abstract）

マルチエージェントワークフロー（MAW）はLLMの複雑タスク性能を向上させる手法として広く採用されているが、MAWが単一エージェントワークフロー（SAW）をいつ・なぜ上回るかの理論的基盤は欠如していた。Yang, Wei, Liang（2025）は、情報理論における「集中度（concentration）」の概念に基づく理論フレームワークを提案し、MAWの優位性が成立する条件を定式化している。

この記事は [Zenn記事: LangGraph Supervisor vs Swarm：マルチエージェントRAGの実装比較](https://zenn.dev/0h_n0/articles/c5c769fcd39455) の深掘りです。

## 情報源

- **arXiv ID**: 2502.12561
- **URL**: [https://arxiv.org/abs/2502.12561](https://arxiv.org/abs/2502.12561)
- **著者**: Yuming Yang, Wei Wei, Jiye Liang
- **発表年**: 2025
- **分野**: cs.AI, cs.MA

## 背景と動機（Background & Motivation）

AutoGen、MetaGPT、LangGraphなどのフレームワークにより、LLMベースのマルチエージェントシステム（MAS）は実用段階に達している。Zenn記事で取り上げたSupervisorパターンやSwarmパターンも、この潮流の中で登場した設計パターンである。

しかし、実務でMASを採用する際の判断基準は経験的なものに留まっていた。「マルチエージェントにすべきか、単一エージェントで十分か」という問いに対する定量的・理論的な回答が存在しなかった。著者らはこの理論的空白を埋めることを目的として、情報理論に基づくフレームワークを提案している。

## 主要な貢献（Key Contributions）

- **貢献1**: タスク解決を確率過程としてモデル化し、エージェントの出力分布の「集中度」概念を導入。MAWの優位性をエラー独立性の観点から定式化
- **貢献2**: MAWがSAWを上回る**必要十分条件**を定理として証明。エラー相関が完全な場合（$\rho = 1$）にはMAWが改善をもたらさないことを示す
- **貢献3**: 最適エージェント数$n^*$の導出式を提示。コスト・協調オーバーヘッド・精度向上のバランスを数理的に表現
- **貢献4**: MATH、HumanEval、MMLU、WebArenaの4ベンチマークで理論予測と実測値の相関$R^2 = 0.82$を確認

## 技術的詳細（Technical Details）

### タスクモデルの定式化

著者らはタスク解決を以下のように確率過程としてモデル化している。

タスク$T$に対して正解$y^*$が存在し、エージェント$A_i$は確率分布$P_i(y \mid T)$に従って解$y_i$を出力する。単一エージェントの条件付きエントロピーは以下で定義される：

$$
H(y \mid T) = -\int P(y \mid T) \log P(y \mid T) \, dy
$$

ここで、
- $H(y \mid T)$: エージェント出力の条件付きエントロピー（不確実性の尺度）
- $P(y \mid T)$: タスク$T$が与えられたときのエージェントの出力分布
- 低エントロピー = 高集中度（一貫して正解を出力する状態）

### MAW優位性の定理（Theorem 1）

$n$個のエージェントが独立なエラー確率$p_i < 0.5$を持つとき、多数決によるMAWの正解確率は以下のように表される：

$$
P(\text{MAW correct}) = \sum_{k > n/2} \binom{n}{k} \prod_{i \in S_k} (1 - p_i) \prod_{j \notin S_k} p_j
$$

ここで、
- $n$: エージェント数
- $p_i$: エージェント$i$のエラー確率（$p_i < 0.5$が前提）
- $S_k$: 正解を出力するエージェントの集合（$|S_k| = k$）
- $\binom{n}{k}$: 二項係数

著者らはこの確率が$n \to \infty$で1に収束することを示している。これはCondorcetの陪審定理のLLMエージェントへの拡張と位置づけられる。

### 負の結果（Theorem 2）

エージェント間のエラー相関が完全な場合（$\rho = 1$）、MAWはSAWに対して改善をもたらさない：

$$
\rho(A_i, A_j) = 1 \implies P(\text{MAW error}) = P(\text{SAW error})
$$

この定理は実務的に重要な示唆を持つ。同一の基盤モデル（例えばClaude Sonnet 4.5）を全エージェントに使用する場合、エラーが相関しやすく、MAWの効果が減殺される可能性がある。Zenn記事のSupervisorパターンとSwarmパターンでは同一モデルを使用しているため、この制約が性能差の一因となり得る。

### 最適エージェント数の導出

著者らは最適エージェント数$n^*$を以下の最適化問題として定式化している：

$$
n^* = \arg\min_n \left[ n \cdot C_{\text{agent}} + C_{\text{coord}}(n) - \text{Gain}(n) \right]
$$

ここで、
- $C_{\text{agent}}$: エージェント1台あたりのコスト（トークン消費量に比例）
- $C_{\text{coord}}(n)$: 協調オーバーヘッド。全対全通信で$O(n^2)$、階層型で$O(n \log n)$
- $\text{Gain}(n)$: 精度向上の利得関数（$n$に対して凹関数）

Zenn記事の4エージェント構成（Query Planner・Retriever・Verifier・Synthesizer）は、Supervisorパターンでは全対全ではなくSupervisorを経由する星型トポロジーのため、$C_{\text{coord}}(n) = O(n)$と近似できる。一方Swarmパターンでは直接ハンドオフにより$C_{\text{coord}}(n) \approx O(n-1)$となる。

### エージェント多様性の分析

著者らはエージェント間の多様性を以下の指標で測定している：

$$
D(A_i, A_j) = 1 - \text{cosine\_similarity}(\text{embed}(y_i), \text{embed}(y_j))
$$

多様性の源泉として以下の4種類を分析している：

1. **モデル多様性**: 異なるバックボーンLLMの使用
2. **プロンプト多様性**: 同一タスクに対する異なるインストラクション
3. **ロール多様性**: 異なる専門的視点の付与
4. **温度多様性**: 異なるサンプリング温度の使用

論文の実験では、中程度の多様性で性能がピークに達することが報告されている。多様性が高すぎる場合、エージェントが異なる問題を解いている状態となり、統合が困難になる。

## 実装のポイント（Implementation）

### MAW採用判断のフローチャート

著者らの理論に基づく実践的な判断基準は以下の通りである：

```python
def should_use_maw(
    saw_accuracy: float,
    task_complexity: str,
    error_correlation: float,
    latency_budget_ms: int,
) -> bool:
    """MAW採用判断ロジック

    Args:
        saw_accuracy: 単一エージェントの精度（0.0-1.0）
        task_complexity: タスク複雑度 ("simple", "moderate", "complex")
        error_correlation: エージェント間エラー相関（0.0-1.0）
        latency_budget_ms: レイテンシ予算（ミリ秒）

    Returns:
        MAWを採用すべきかどうか
    """
    # 条件1: SAW精度が既に高い場合はMAW不要
    if saw_accuracy > 0.9:
        return False

    # 条件2: エラー相関が高い場合はMAWの効果が薄い
    if error_correlation > 0.8:
        return False

    # 条件3: レイテンシ制約が厳しい場合はSAWを優先
    if latency_budget_ms < 2000 and task_complexity == "simple":
        return False

    # 条件4: 複雑なタスクでSAW精度が低い場合はMAW推奨
    if task_complexity == "complex" and saw_accuracy < 0.7:
        return True

    return task_complexity in ("moderate", "complex")
```

### 多様性確保の実装パターン

論文の知見を基に、LangGraphでの多様性確保は以下のアプローチが有効である：

```python
from langchain_anthropic import ChatAnthropic

def create_diverse_agents() -> list:
    """多様性を確保したエージェント群を作成する

    Returns:
        多様性が確保されたエージェントのリスト
    """
    # ロール多様性: 各エージェントに異なる専門性を付与
    roles = [
        {"name": "analyst", "temp": 0.0, "focus": "精度重視"},
        {"name": "explorer", "temp": 0.7, "focus": "探索的思考"},
        {"name": "critic", "temp": 0.3, "focus": "批判的検証"},
    ]

    agents = []
    for role in roles:
        model = ChatAnthropic(
            model="claude-sonnet-4-5-20250929",
            temperature=role["temp"],
        )
        agents.append({"model": model, "role": role})

    return agents
```

## 実験結果（Results）

著者らは4つのベンチマークで理論の検証を行っている（論文Table 1より）：

| タスク | SAW (GPT-4) | Self-Consistency | MAW-Voting | MAW-Specialized |
|--------|-------------|------------------|------------|-----------------|
| MATH | 52.3% | 61.2% | 58.4% | **67.8%** |
| HumanEval | 78.6% | 82.1% | 80.3% | **86.4%** |
| MMLU | 86.2% | 87.4% | 88.1% | **90.2%** |
| WebArena | 14.2% | 15.8% | 18.6% | **22.4%** |

注目すべき点として、著者らは以下を報告している：

- **MAW-Specialized**（ドメイン特化エージェント）が全ベンチマークで最高精度。同一モデルの並列実行（MAW-Voting）よりも、役割特化エージェント群が優れる
- **MMLU**（SAW精度86.2%）ではMAWの改善幅が限定的（+4.0ポイント）。論文のTheorem 2の予測（SAW精度が高いタスクではMAW効果が小さい）と一致
- **WebArena**（SAW精度14.2%）ではMAW-Specializedが+8.2ポイントの改善。複雑かつSAW精度が低いタスクでMAWの効果が顕著
- 理論予測と実測値の相関は$R^2 = 0.82$（論文Section 4.3）

## 実運用への応用（Practical Applications）

### Zenn記事との関連

Zenn記事で比較したSupervisorパターン（Faithfulness 0.91）とSwarmパターン（Faithfulness 0.87）の性能差は、本論文の理論で以下のように説明できる：

1. **Supervisorパターンの高Faithfulness**: Supervisorが全エージェントの出力を検証するため、実質的な「多数決＋検証」に近い効果がある。論文のMAW-Specializedパターンに対応
2. **Swarmパターンの低レイテンシ**: 直接ハンドオフにより$C_{\text{coord}}(n)$が削減され、Supervisorの往復通信コストを回避。ただし検証ステップの省略により精度がやや低下

### コスト効率の判断基準

論文の$n^*$導出式をZenn記事の構成に適用すると、以下の判断が導かれる：

- 4エージェント構成はトークンコスト3-4倍（Zenn記事の実測値12,800トークン/クエリ）を許容する場合に正当化される
- ハイブリッドルーター（Zenn記事のroute_query関数）は、論文の「SAW精度>90%ならMAW不要」という知見と整合する設計である

## 関連研究（Related Work）

- **AutoGen (Wu et al., 2023)**: Microsoftのマルチエージェント会話フレームワーク。本論文ではMAWの代表的実装として参照されている
- **MetaGPT (Hong et al., 2023)**: ソフトウェア開発チームのシミュレーション。ロール特化による多様性確保の先駆的実装
- **Condorcetの陪審定理 (1785)**: 独立した判断者の多数決が個人より正確になるという古典的定理。本論文はこれをLLMエージェントに拡張している

## まとめと今後の展望

Yang, Wei, Liangは、MAWがSAWを上回る条件をエージェント間のエラー独立性と集中度の概念で定式化した。主要な知見として、(1) エージェントのエラーが独立であればMAWは多数決により精度が向上する、(2) エラーが完全に相関する場合はMAWの効果がない、(3) 最適エージェント数はコスト・協調オーバーヘッド・精度のトレードオフで決まる、という3点が理論的に示された。

今後の研究方向として、同一基盤モデル使用時のエラー相関低減手法や、動的なエージェント数調整メカニズムが挙げられている。

## 参考文献

- **arXiv**: [https://arxiv.org/abs/2502.12561](https://arxiv.org/abs/2502.12561)
- **Related Zenn article**: [https://zenn.dev/0h_n0/articles/c5c769fcd39455](https://zenn.dev/0h_n0/articles/c5c769fcd39455)
